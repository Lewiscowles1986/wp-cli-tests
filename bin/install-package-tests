#!/bin/sh

set -ex

PASSWORD_STRING=""
if [ -z "DB_PASSWORD" ]; then
  PASSWORD_STRING="-p${DB_PASSWORD}"
fi;

# Prepare the database for running the tests
install_db() {
	mysql -e 'CREATE DATABASE IF NOT EXISTS wp_cli_test;' -uroot "$PASSWORD_STRING"
	mysql -e 'CREATE USER "wp_cli_test"@"localhost" IDENTIFIED BY "password1"' -uroot "$PASSWORD_STRING"
	mysql -e 'GRANT ALL PRIVILEGES ON wp_cli_test.* TO "wp_cli_test"@"localhost"' -uroot "$PASSWORD_STRING"
	mysql -e 'GRANT ALL PRIVILEGES ON wp_cli_test_scaffold.* TO "wp_cli_test"@"localhost"' -uroot "$PASSWORD_STRING"
}

install_db
